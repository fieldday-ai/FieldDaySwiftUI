# FieldDay iOS SDK

![fdsdk](https://github.com/fieldday-ai/fieldday-ios-sdk/assets/58298401/49097712-e46d-4fa8-91b7-28c648f47926)

# Installation

You can add the FieldDay iOS SDK using Swift Package Manager.

-   From the File menu, select Add Packages...
-   Enter the repo's URL

```
http://github.com/fieldday-ai/fieldday-ios-sdk.git
```

# Prepare Xcode Project

-   [Add the FieldDay Package](#installation)
-   Provide Camera Usage Description
    -   Project > Build Settings
    -   Scroll to Info.plist Values
    -   Find "Privacy - Camera Usage Description"
    -   Provide a suitable description of why you wish to access the Camera
-   [Optional] Lock the supported screen orientations
    -   Target > General > Deployment Info
    -   iPhone Orientation
    -   Check only Portrait

# Setup FieldDay Project

There are two methods to use your FieldDay project with the iOS SDK. To get started, open your project in the FieldDay app. Make sure you have trained at least one model in the project.

## Method 1: Publishing your project

FieldDay allows you to publish your project so it can be fetched over the internet. Using this method, you can ensure your project is always kept up-to-date with any changes you make. The package caches the project information. Select the appropriate cache policy as per your requirements.

-   Tap the share button at the top right corner of the screen.
-   Select the `CoreML` option.
-   Tap "Publish Project".
-   Copy the alphanumeric Project Key that appears.

### Usage

```swift
import SwiftUI
import FieldDay

struct ContentView: View {
    var body: some View {
        FDViewfinderView(
            /// Enter the Project Key that we copied from FieldDay
            projectKey: "________________________________"
        )
    }
}
```

## Method 2: Use a CoreML `.mlmodel` file

Alternatively, you can also package a model file with your app. This has the advantage of always working offline. But you will need to update it manually to include changes from your FieldDay project.

-   Tap the share button at the top right corner of the screen.
-   Select the `CoreML` option.
-   Tap "Export `.mlmodel`". This will give you two files ‚Äì `Categories.swift` and `Project Name.mlmodel`.
-   Add the two files to the Xcode project.

### Usage

```swift
import SwiftUI
import FieldDay

struct ContentView: View {
    var body: some View {
        FDViewfinderView(
            modelURL: Project_Name.urlOfModelInThisBundle,
            // A class like "Project_Name" is automatically generated by Xcode for your model.
            // Open the `.mlmodel` file in Xcode to find the class name.
            categories: categories
            // This array is defined in the Categories.swift file.
            // You can edit the category names or colours.
        )
    }
}
```

# Advanced Usage

## Handle prediction events

At the moment, the FieldDay SDK supports handling the following events:

-   When the model makes a prediction
-   When a prediction pill is tapped

_A prediction pill is the element at the bottom of the screen, showing the category name for the prediction_

These events can be handled via the `onPrediction` and `onPredictionTap` modifiers on the ViewfinderView. They can be used as follows.

```swift
import SwiftUI
import FieldDay

struct ContentView: View {
    var body: some View {
        FDViewfinderView(...)
            .onPredictionTap { category in
                print(category.name)
            }
            .onPrediction { prediction, category in
                print(category.name, prediction.confidence)
            }
    }
}
```

**`FDCategory`**

```swift
struct FDCategory {
    var id: String
    var name: String
    var color: Color
    var isBackground: Bool
}
```

-   `id` - The unique identifier of the category
-   `name` - The category's name (defined in the FieldDay App)
-   `color` - The category's color (defined in the FieldDay App)
-   `isBackground` - Indicates whether the category is the default "Background" category

**`FDModelPrediction`**

```swift
struct FDModelPrediction {
    var identifier: String
    var confidence: Float
    var results: [VNClassificationObservation]
}
```

-   `identifier` - The identifier returned associated with the CoreML prediction
-   `confidence` - The confidence of the prediction, normalized from `0...1`
-   `results` - Contains confidence values for all categories in the model

## Debugging

To view debugging logs that expose error messages for various operations - just add the `.debug()` modifier to your `FDViewfinderView`. FieldDay logs will be prefixed with "ü§ñ‚ö†Ô∏è".

```swift
import SwiftUI
import FieldDay

struct ContentView: View {
    var body: some View {
        FDViewfinderView(...)
            .debug()
    }
}
```
